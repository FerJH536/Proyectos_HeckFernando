<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Gestión de Productos</title>

<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #0a192f, #112240);
        color: #e6f1ff;
        margin: 0;
        padding: 30px;
    }

    h2 {
        text-align: center;
        color: #64ffda;
        margin-bottom: 30px;
    }

    .stats {
        text-align: center;
        margin-bottom: 20px;
        color: #8892b0;
    }

    .filtros {
        background: #112240;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 25px;
        box-shadow: 0 0 10px rgba(0,0,0,0.4);
    }

    .filtro-grupo {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    label {
        color: #ccd6f6;
        font-weight: bold;
        flex: 1;
    }

    input, select {
        flex: 2;
        padding: 8px;
        border-radius: 8px;
        border: none;
        outline: none;
        background: #0a192f;
        color: #fff;
    }

    button {
        background: #64ffda;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        color: #0a192f;
        font-weight: bold;
        margin-right: 10px;
        transition: all 0.3s ease;
    }

    button:hover {
        background: #52e0c4;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: #112240;
        border-radius: 12px;
        overflow: hidden;
    }

    th, td {
        padding: 12px;
        text-align: left;
    }

    th {
        background: #0a192f;
        color: #64ffda;
    }

    tr:nth-child(even) {
        background: #0d1b2a;
    }

    tr:hover {
        background: #1b2a41;
    }

    #mensaje {
        text-align: center;
        color: #64ffda;
        margin-top: 20px;
    }
</style>
</head>

<body>
    <h2>Sistema de Gestión de Productos</h2>

    <div class="stats">
        Total de productos: <span id="totalProductos">0</span> |
        Valor total stock: $<span id="valorTotal">0</span>
    </div>

    <div class="filtros">
        <div class="filtro-grupo">
            <label>Buscar:</label>
            <input type="text" id="buscar" placeholder="Buscar por nombre...">
        </div>

        <div class="filtro-grupo">
            <label>Categoría:</label>
            <select id="categoria">
                <option value="todas">Todas</option>
                <option value="Electronica">Electrónica</option>
                <option value="Ropa">Ropa</option>
            </select>
        </div>

        <button id="aplicarFiltros">Aplicar filtros</button>
        <button id="limpiarFiltros">Limpiar</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Categoría</th>
                <th>Precio</th>
                <th>Stock</th>
                <th>Valor Total</th>
            </tr>
        </thead>
        <tbody id="cuerpoTabla"></tbody>
    </table>

    <p id="mensaje"></p>

<script>
let productos = [];
let productosFiltrados = [];

// Cargar productos desde el backend
function cargarProductos() {
    fetch("obtener.php")
        .then(res => res.json())
        .then(data => {
            productos = data;
            productosFiltrados = [...productos];
            mostrarProductos(productos);
        })
        .catch(err => console.error("Error al obtener productos:", err));
}

// Mostrar productos en la tabla
function mostrarProductos(productos) {
    const cuerpo = document.getElementById("cuerpoTabla");
    cuerpo.innerHTML = "";

    if (productos.length === 0) {
        cuerpo.innerHTML = `<tr><td colspan="6" style="text-align:center;">No se encontraron productos.</td></tr>`;
        document.getElementById("totalProductos").textContent = 0;
        document.getElementById("valorTotal").textContent = 0;
        return;
    }

    productos.forEach(p => {
        const fila = document.createElement("tr");
        fila.innerHTML = `
            <td>${p.IdProducto}</td>
            <td>${p.nombre_producto}</td>
            <td>${p.categoria}</td>
            <td>$${parseFloat(p.precio).toLocaleString()}</td>
            <td>${p.stock}</td>
            <td>$${(p.precio * p.stock).toLocaleString()}</td>
        `;
        cuerpo.appendChild(fila);
    });

    actualizarEstadisticas(productos);
}

// Actualizar estadísticas
function actualizarEstadisticas(productos) {
    document.getElementById("totalProductos").textContent = productos.length;
    const total = productos.reduce((sum, p) => sum + (p.precio * p.stock), 0);
    document.getElementById("valorTotal").textContent = total.toLocaleString();
}

// Aplicar filtros
function aplicarFiltros() {
    const texto = document.getElementById("buscar").value.toLowerCase();
    const categoria = document.getElementById("categoria").value;

    productosFiltrados = productos.filter(p => {
        const coincideNombre = p.nombre.toLowerCase().includes(texto);
        const coincideCategoria = categoria === "todas" || p.categoria === categoria;
        return coincideNombre && coincideCategoria;
    });

    mostrarProductos(productosFiltrados);
}

// Limpiar filtros
function limpiarFiltros() {
    document.getElementById("buscar").value = "";
    document.getElementById("categoria").value = "todas";
    productosFiltrados = [...productos];
    mostrarProductos(productosFiltrados);
}

// Eventos
document.getElementById("aplicarFiltros").addEventListener("click", aplicarFiltros);
document.getElementById("limpiarFiltros").addEventListener("click", limpiarFiltros);

// Inicialización
cargarProductos();
</script>
</body>
</html>
